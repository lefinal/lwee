"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7509],{517:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var r=t(5893),i=t(1151);const s={sidebar_position:100},o="Go SDK",l={id:"go-sdk",title:"Go SDK",description:"The LWEE Go SDK provides an easy way of building actions with the Go programming language.",source:"@site/docs/go-sdk.mdx",sourceDirName:".",slug:"/go-sdk",permalink:"/lwee/go-sdk",draft:!1,unlisted:!1,editUrl:"https://github.com/lefinal/lwee/docs/docs/go-sdk.mdx",tags:[],version:"current",sidebarPosition:100,frontMatter:{sidebar_position:100},sidebar:"tutorialSidebar",previous:{title:"Streams",permalink:"/lwee/streams"}},a={},c=[{value:"Getting started",id:"getting-started",level:2},{value:"Concepts",id:"concepts",level:2},{value:"Creating the client",id:"creating-the-client",level:2},{value:"Registering input stream requests",id:"registering-input-stream-requests",level:2},{value:"Registering output stream offers",id:"registering-output-stream-offers",level:2},{value:"Adding application logic",id:"adding-application-logic",level:2},{value:"Starting the client",id:"starting-the-client",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"go-sdk",children:"Go SDK"}),"\n",(0,r.jsxs)(n.p,{children:["The LWEE Go SDK provides an easy way of building actions with the ",(0,r.jsx)(n.a,{href:"https://go.dev/",children:"Go"})," programming language.\nThe concurrency concepts and fast learning curve make it appealing to building applications with it.\nLWEE provides you with an SDK to make it even easier.\nUnder the hood, it uses ",(0,r.jsx)(n.a,{href:"/lwee/streams",children:"LWEE streams"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"getting-started",children:"Getting started"}),"\n",(0,r.jsx)(n.p,{children:"Create a new project action with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"lwee create-action\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Enter your action name.\nThis will also be the name of the module.\nThen, select ",(0,r.jsx)(n.strong,{children:"Go (SDK)"})," as template.\nYour action is now created and initialized with a template."]}),"\n",(0,r.jsx)(n.p,{children:"If you want to add the Go SDK to an existing project, you can run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"go get -u github.com/lefinal/lwee/go-sdk\n"})}),"\n",(0,r.jsx)(n.h2,{id:"concepts",children:"Concepts"}),"\n",(0,r.jsxs)(n.p,{children:["The SDK uses ",(0,r.jsx)(n.a,{href:"/lwee/streams",children:"LWEE streams"})," for data transmission.\nFor a simple application you need to perform these steps:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Create a client."}),"\n",(0,r.jsx)(n.li,{children:"Register your input stream requests."}),"\n",(0,r.jsx)(n.li,{children:"Register your output stream offers."}),"\n",(0,r.jsx)(n.li,{children:"Add your data handling."}),"\n",(0,r.jsx)(n.li,{children:"Serve the client."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"How to do that will be explained in the following sections.\nWe will explain the template step by step.\nNote that we do not add specific error handling.\nProper error handling is your own responsibility."}),"\n",(0,r.jsx)(n.h2,{id:"creating-the-client",children:"Creating the client"}),"\n",(0,r.jsx)(n.p,{children:"First, we need to import the SDK into our application/file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'import "github.com/lefinal/lwee/go-sdk/lweeclient"\n'})}),"\n",(0,r.jsx)(n.p,{children:"Then, we need to create an LWEE client."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"client := lweeclient.New(lweeclient.Options{})\n"})}),"\n",(0,r.jsx)(n.p,{children:"Normally, you do not need to supply any options."}),"\n",(0,r.jsx)(n.h2,{id:"registering-input-stream-requests",children:"Registering input stream requests"}),"\n",(0,r.jsx)(n.p,{children:"Each input stream has a name.\nWe create a request for it in the following way:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'entriesInput, err := client.RequestInputStream("entries")\nif err != nil {\n    log.Fatal(err)\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["This adds a request for the input stream with name ",(0,r.jsx)(n.em,{children:"entries"}),".\nThe returned value is of type ",(0,r.jsx)(n.code,{children:"lweeclient.InputReader"}),".\nIt implements the ",(0,r.jsx)(n.code,{children:"io.Reader"})," interface along with ",(0,r.jsx)(n.code,{children:"WaitForInput(context.Context) error"}),".\nWe will use this reader later."]}),"\n",(0,r.jsx)(n.p,{children:"Add all remaining input stream requests."}),"\n",(0,r.jsx)(n.h2,{id:"registering-output-stream-offers",children:"Registering output stream offers"}),"\n",(0,r.jsx)(n.p,{children:"Each output stream has a name as well.\nWe create offers like this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'entryCountOutput, err := client.ProvideOutputStream("entryCount")\nif err != nil {\n    log.Fatal(err)\n}\ndefer entryCountOutput.Close(nil)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["This adds an offer for the output stream with name ",(0,r.jsx)(n.em,{children:"entryCount"}),".\nThe returned value is an ",(0,r.jsx)(n.code,{children:"lweeclient.OutputWriter"})," which implements ",(0,r.jsx)(n.code,{children:"io.WriteCloser"})," along with ",(0,r.jsx)(n.code,{children:"Open() error"})," and ",(0,r.jsx)(n.code,{children:"Close(error)"}),"."]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["In Go, it is considered best-practice to ",(0,r.jsx)(n.code,{children:"defer"})," closing of resources to minimize chances of forgetting to close them which could lead to resource leaks.\nThe ",(0,r.jsx)(n.code,{children:"defer"})," statement will close the body when the function exits."]})}),"\n",(0,r.jsx)(n.p,{children:"Add your remaining output stream offers as well."}),"\n",(0,r.jsx)(n.h2,{id:"adding-application-logic",children:"Adding application logic"}),"\n",(0,r.jsx)(n.p,{children:"When dealing with data, we will work on the created input readers and output writers.\nIn most cases, we wait for input streams to open.\nWe will then read data from them and process it.\nOnce output data is available, we will open the corresponding output stream(s) once and then write our data."}),"\n",(0,r.jsx)(n.p,{children:"In the following example, we expect the input stream to receive entries, separated by line separators.\nWe want to count the number of entries (lines).\nLet's get started and add our logic."}),"\n",(0,r.jsxs)(n.p,{children:["To do so, we register a do-function on the client.\nThis is just a helper method so that we can skip synchronizing multiple goroutines and managing ",(0,r.jsx)(n.code,{children:"context.Context"})," by letting the SDK handle it for us.\nThe method signature is as follows:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"Do(func(ctx context.Context) error)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This will start the function in a new goroutine and pass the client's lifetime context.\nIf the function returns an error, execution will be considered failed and the client shuts down.\nThe client will block in ",(0,r.jsx)(n.code,{children:"Serve"})," (see below) until all functions, registered via ",(0,r.jsx)(n.code,{children:"Do"})," have finished."]}),"\n",(0,r.jsx)(n.p,{children:"Let us get back to our example:\nFirst, we need to wait until our input stream with the entries is open."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'err := entriesInput.WaitForOpen(ctx)\nif err != nil {\n    return fmt.Errorf("wait for entries input to open: %w", err)\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Then, we need to create a scanner so that we can read each line separately.\nWe do not want to read all input data at once as we expect large data amounts.\nTherefore, we use I/O directly."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'scanner := bufio.NewScanner(entriesInput)\nentryCount := 0\nfor scanner.Scan() {\n    entryCount++\n}\nerr = scanner.Err()\nif err != nil {\n    return fmt.Errorf("read entries input: %w", err)\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Now that we have our entry count, we can output it.\nTo do that, we first notify LWEE that the output is ready:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'err = entryCountOutput.Open()\nif err != nil {\n    return fmt.Errorf("open entry count output: %w", err)\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Then we write the result to the output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'_, err = io.Copy(entryCountOutput, strings.NewReader(strconv.Itoa(entryCount)))\nif err != nil {\n    return fmt.Errorf("output entry count: %w", err)\n}\nentryCountOutput.Close(nil)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["At the end, we simply return ",(0,r.jsx)(n.code,{children:"nil"}),"."]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["In case of an error and not using ",(0,r.jsx)(n.code,{children:"Do"}),", you could also close the output with a non-nil error.\nThis will also notify LWEE that execution failed and the client will shut down as well."]})}),"\n",(0,r.jsx)(n.h2,{id:"starting-the-client",children:"Starting the client"}),"\n",(0,r.jsxs)(n.p,{children:["Finally, outside the ",(0,r.jsx)(n.code,{children:"Do"})," function, we can now start the client with ",(0,r.jsx)(n.code,{children:"Serve()"}),".\nThis will serve the HTTP API used by LWEE to connect.\nThe call will block until the client is instructed by LWEE to shut down and all ",(0,r.jsx)(n.code,{children:"Do"}),"-functions have finished."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"err = client.Serve()\nif err != nil {\n    log.Fatal(err)\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>l,a:()=>o});var r=t(7294);const i={},s=r.createContext(i);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);